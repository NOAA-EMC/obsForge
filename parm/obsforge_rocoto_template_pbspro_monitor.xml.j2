<?xml version="1.0"?>
<!DOCTYPE workflow
[
	<!ENTITY PSLOT "{{ PSLOT }}">
	<!ENTITY ROTDIR "{{ COMROOT }}/{{ PSLOT }}">
	<!ENTITY JOBS_DIR "{{ HOMEobsforge }}/jobs/rocoto">
	<!ENTITY MAXTRIES "2">
]>

<workflow realtime="F" scheduler="{{ SCHEDULER }}" cyclethrottle="1" taskthrottle="25">

	<log verbosity="10"><cyclestr>{{ COMROOT }}/{{ PSLOT }}/logs/@Y@m@d@H.log</cyclestr></log>

	<!-- Define the cycles -->
	<cycledef group="gdas">{{ SDATE }} {{ EDATE }} 06:00:00</cycledef>
	<cycledef group="gfs">{{ SDATE }} {{ EDATE }} 06:00:00</cycledef>
	<cycledef group="gcdas">{{ SDATE }} {{ EDATE }} 06:00:00</cycledef>



<!--
	============================================
	Task: obsforge_monitor
	============================================
-->
<task name="obsforge_monitor" cycledefs="gdas" maxtries="&MAXTRIES;">

	<command>{{ HOMEobsforge }}/jobs/rocoto/obsforgemonitor.sh</command>

	<jobname><cyclestr>obsforge_monitor@H</cyclestr></jobname>

<!--
    <dependency>
        <and>
            <taskdep task="gfs_aod_dump"/>
            <taskdep task="gfs_marine_dump"/>
            <taskdep task="gfs_marine_bufr_dump"/>
            <taskdep task="gcdas_aod_dump"/>
            <taskdep task="gdas_aod_dump"/>
            <taskdep task="gdas_atmos_bufr_dump"/>
            <taskdep task="gdas_marine_dump"/>
            <taskdep task="gdas_marine_bufr_dump"/>
        </and>
    </dependency>
-->

	<account>{{ ACCOUNT }}</account>
	<queue>{{ QUEUE }}</queue>
	<walltime>{{ WALLTIME_MONITOR }}</walltime>
	<nodes>{{ TASK_GEOM_MONITOR }}</nodes>
	<memory>{{ MEMORY_MONITOR }}</memory>
	<native>-l place=vscatter:shared</native>

	<join><cyclestr>{{ COMROOT }}/{{ PSLOT }}/logs/@Y@m@d@H/monitor.log</cyclestr></join>

	<envar><name>RUN_ENVIR</name><value>emc</value></envar>
	<envar><name>HOMEobsforge</name><value>{{ HOMEobsforge }}</value></envar>
	<envar><name>NET</name><value>gdas</value></envar>
	<envar><name>RUN</name><value>gdas</value></envar>
	<envar><name>CDATE</name><value><cyclestr>@Y@m@d@H</cyclestr></value></envar>
	<envar><name>PDY</name><value><cyclestr>@Y@m@d</cyclestr></value></envar>
	<envar><name>cyc</name><value><cyclestr>@H</cyclestr></value></envar>
	<envar><name>KEEPDATA</name><value>{{ KEEPDATA }}</value></envar>
	<envar><name>COMROOT</name><value>{{ COMROOT }}</value></envar>
	<envar><name>DCOMROOT</name><value>{{ DCOMROOT }}</value></envar>
	<envar><name>DATAROOT</name><value>{{ DATAROOT }}/{{ PSLOT }}/gdas.<cyclestr>@Y@m@d@H</cyclestr></value></envar>


</task>


</workflow>

